function qd_null = MAX_Manipulate(k0,q)
% To calculate the qdot which satisfy the objective function w = -sqrt(det(JJ'))

%%% compute with symbolic in Derivation_of_w.m and get the qd. We don't use
%%% symbolic computation in simulation because it is too slow. So we do
%%% that before simulation in Derivation_of_w.m script.

% q1 = sym('q1');
% q2 = sym('q2');
% q3 = sym('q3');
% J =[ -sin(q1 + q2 + q3) - sin(q1 + q2) - sin(q1),  -sin(q1 + q2 + q3) - sin(q1 + q2),  -sin(q1 + q2 + q3);
%       cos(q1 + q2 + q3) + cos(q1 + q2) + cos(q1),   cos(q1 + q2 + q3) + cos(q1 + q2),  cos(q1 + q2 + q3)];
%    
% JT = [-sin(q1 + q2 + q3) - sin(q1 + q2) - sin(q1), cos(q1 + q2 + q3)+cos(q1 + q2)+cos(q1);
%       -sin(q1 + q2 + q3) - sin(q1 + q2),           cos(q1 + q2 + q3) + cos(q1 + q2);
%       -sin(q1 + q2 + q3),                          cos(q1 + q2 + q3)];
%   
% H = J*JT;  
% W = -sqrt(det(H));
% qdot1=diff(W,q1);
% qdot2=diff(W,q2);
% qdot3=diff(W,q3);
% 
% qd_null1 = subs(qdot1,{q1,q2,q3},{q(1),q(2),q(3)});
% qd_null2 = subs(qdot2,{q1,q2,q3},{q(1),q(2),q(3)});
% qd_null3 = subs(qdot3,{q1,q2,q3},{q(1),q(2),q(3)});
% qd_null = k0*[qd_null1;qd_null2;qd_null3];

q1 = q(1);
q2 = q(2);
q3 = q(3);

% Results from Derivation_of_w.m script
qd_null = k0*[ 0; (2*cos(q1 + q2)^2*cos(q1)*sin(q1)...
                  - 2*sin(q1 + q2)^2*cos(q1)*sin(q1)...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)^2 ...
                  - 2*sin(q1 + q2 + q3)*cos(q1 + q2)*cos(q1)^2 ...
                  + 2*cos(q1 + q2 + q3)^2*sin(q1 + q2)*cos(q1) ...
                  + 2*cos(q1 + q2 + q3)*sin(q1 + q2)*sin(q1)^2 ...
                  + 2*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1)^2 ...
                  - 2*sin(q1 + q2 + q3)^2*cos(q1 + q2)*sin(q1) ...
                  + 4*cos(q1 + q2 + q3)^2*cos(q1)*sin(q1) ...
                  - 4*sin(q1 + q2 + q3)^2*cos(q1)*sin(q1) ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1)^2 ...
                  + 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1)^2 ...
                  - 2*cos(q1 + q2)*sin(q1 + q2)*cos(q1)^2 ...
                  + 2*cos(q1 + q2)*sin(q1 + q2)*sin(q1)^2 ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*cos(q1) ...
                  + 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1 + q2)*sin(q1) ...
                  + 4*cos(q1 + q2 + q3)*cos(q1 + q2)*cos(q1)*sin(q1) ...
                  - 4*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)*sin(q1))/(2*(2*cos(q1 + q2 + q3)^2*sin(q1 + q2)^2 ...
                  + 2*cos(q1 + q2 + q3)^2*sin(q1 + q2)*sin(q1) + 2*cos(q1 + q2 + q3)^2*sin(q1)^2 ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1 + q2) ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1) ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1) ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1)*sin(q1) ...
                  + 2*cos(q1 + q2 + q3)*cos(q1 + q2)*sin(q1)^2 ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)*sin(q1) ...
                  + 2*sin(q1 + q2 + q3)^2*cos(q1 + q2)^2 + 2*sin(q1 ...
                  + q2 + q3)^2*cos(q1 + q2)*cos(q1) + 2*sin(q1 + q2 + q3)^2*cos(q1)^2 ...
                  - 2*sin(q1 + q2 + q3)*cos(q1 + q2)*cos(q1)*sin(q1) ...
                  + 2*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)^2 ...
                  + cos(q1 + q2)^2*sin(q1)^2 - 2*cos(q1 + q2)*sin(q1 + q2)*cos(q1)*sin(q1) ...
                  + sin(q1 + q2)^2*cos(q1)^2)^(1/2));
                  (4*cos(q1 + q2 + q3)^2*cos(q1 + q2)*sin(q1 + q2) ...
                  - 4*sin(q1 + q2 + q3)^2*cos(q1 + q2)*sin(q1 + q2) ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)^2 ...
                  + 2*cos(q1 + q2 + q3)^2*cos(q1 + q2)*sin(q1) ...
                  + 2*cos(q1 + q2 + q3)^2*sin(q1 + q2)*cos(q1) ...
                  + 2*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1)^2 ...
                  - 2*sin(q1 + q2 + q3)^2*cos(q1 + q2)*sin(q1) ...
                  - 2*sin(q1 + q2 + q3)^2*sin(q1 + q2)*cos(q1) ...
                  + 4*cos(q1 + q2 + q3)^2*cos(q1)*sin(q1) ...
                  - 4*sin(q1 + q2 + q3)^2*cos(q1)*sin(q1) ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)^2 ...
                  + 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1 + q2)^2 ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1)^2 ...
                  + 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1)^2 ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*cos(q1) ...
                  + 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1 + q2)*sin(q1) ...
                  + 2*cos(q1 + q2 + q3)*cos(q1 + q2)*cos(q1)*sin(q1) ...
                  - 2*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)*sin(q1))/(2*(2*cos(q1 + q2 + q3)^2*sin(q1 + q2)^2 ...
                  + 2*cos(q1 + q2 + q3)^2*sin(q1 + q2)*sin(q1) ...
                  + 2*cos(q1 + q2 + q3)^2*sin(q1)^2 ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1 + q2) ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1 + q2)*sin(q1) ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1) ...
                  - 4*cos(q1 + q2 + q3)*sin(q1 + q2 + q3)*cos(q1)*sin(q1) ...
                  + 2*cos(q1 + q2 + q3)*cos(q1 + q2)*sin(q1)^2 ...
                  - 2*cos(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)*sin(q1) ...
                  + 2*sin(q1 + q2 + q3)^2*cos(q1 + q2)^2 + 2*sin(q1 + q2 + q3)^2*cos(q1 + q2)*cos(q1) ...
                  + 2*sin(q1 + q2 + q3)^2*cos(q1)^2 - 2*sin(q1 + q2 + q3)*cos(q1 + q2)*cos(q1)*sin(q1) ...
                  + 2*sin(q1 + q2 + q3)*sin(q1 + q2)*cos(q1)^2 + cos(q1 + q2)^2*sin(q1)^2 ...
                  - 2*cos(q1 + q2)*sin(q1 + q2)*cos(q1)*sin(q1) + sin(q1 + q2)^2*cos(q1)^2)^(1/2))];
end

